<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Social Network</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
  </head>
  <body>
  
  <nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      </button>
		<a class="navbar-brand" href="#">
			<h2>Sociálna sieť<h2>
		</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		  <!--
		  <ul class="nav navbar-nav navbar-static-bottom">
			<li class="active"><a href="#">Domov<span class="sr-only">(current)</span></a></li>
			<li class="active"><a href="#">Profil<span class="sr-only">(current)</span></a></li>
		  </ul>
		  -->
	  	<div class="nav navbar-nav">
			<h1></h1>
		</div>
		<div class="nav navbar-nav navbar-right">
			<button type="button" class="btn btn-default navbar-btn">Odhlásiť sa</button>
		</div>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
  
<div class="row">
	
	<div class="col-md-2">
	<div class="row">
		<div class="col-md-2"></div>
		
		<div class="col-md-10">
		
			<ul id="room_list" class="nav nav-pills nav-stacked">
				<li role="presentation" class="active"><a href="#">Roomka<span class="badge">2</span></a></li>
				<li role="presentation"><a href="#">Nova meistnost<span class="badge">0</span></a></li>
				<li role="presentation"><a href="#">Vecerna diskusia<span class="badge">42</span></a></li>
			</ul>
	  
		</div>
		</div>
	</div>
	
	<div class="col-md-5">
	  
		<!-- PRIDAVANIE PRISPEVKU -->
		<div class="row">
			
			<div class="panel panel-default">
			<div class="panel-body">
			
				<div class="col-md-2">
					<img src="profile.png" alt="obrazok" class="img-rounded" height="100px" width="100px">
				</div>
				
				<div class="col-md-10">
					<div class="">
					<input type="text" class="form-control input-lg" placeholder="Zverejni príspevok" style="height:100px;">
						<!-- <input type="text" class="form-control input-lg" placeholder="Post something">
						<textarea rows="4" cols="50">
				
						</textarea>
						-->
						 
					</div>
					<button type="button" class="btn btn-default" aria-label="Left Align">Odošli</button>
					
				</div>
				
			</div>
			</div>
		  
		</div>	
		
		<!-- FEED -->
		<div id="feed">
			<!-- POST -->
			<div class="row feed_post">	
				
				<div class="panel panel-default">
				<div class="panel-body">
					<!-- Avatar -->
					<div class="col-md-2">
						<img src="profile.png" alt="obrazok" class="img-rounded avatar" height="100px" width="100px">
					</div>
					<!-- Obsah -->
					<div class="col-md-10">
						<div class="col-md-12">
						
						<div class="panel panel-default">
							
							<div class="panel-heading">
								<h4 class="post_owner">Ján Kanás</h4>
							</div>
							<div class="panel-body">

								<p class="post_text">
								Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse pretium tellus lacus, eu elementum nisl pulvinar a. Praesent id risus ac neque porta bibendum. Donec ligula mauris, luctus eu blandit sed, tincidunt posuere ipsum. 
								</p>
							
							</div>
							<div class="panel-footer">
								<!-- Like -->
								<button type="button" class="btn btn-default post_like_button" aria-label="Left Align">
									<span class="glyphicon glyphicon-heart" aria-hidden="true">
									<span class="badge post_likes">9</span>
									</span>
								</button>
								
								<!-- Komentár -->
								<button type="button" class="btn btn-default post_comment_button" aria-label="Left Align">
									<span class="glyphicon glyphicon-comment" aria-hidden="true">
									<span class="badge post_comments">1</span>
									</span>
								</button>
								
							</div>
				
						</div>
						
						<div class="row post_comment col-md-12">
							
						</div>
						
						</div>
					</div>
				</div>
				</div>
			</div>
		</div>
	
		<!--  
		<div class="row">																						
		<div class="col-md-12">									
				<div class="panel panel-default">
				
				<div class="panel-heading">
					
					<div class="media ">
					  <div class="media-left media-middle">
						<a href="#">
						  <img src="profile.png" alt="obrazok" class="img-rounded" height="50px" width="50px" >
						</a>
					  </div>
					  <div class="media-body">
						<br>
						<h4 class="media-heading">Ján Kanás</h4>
					  </div>
					</div>
					
				</div>
				<div class="panel-body">
			
					<p>
					Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse pretium tellus lacus, eu elementum nisl pulvinar a. Praesent id risus ac neque porta bibendum.
					</p>
				
				</div>
				<div class="panel-footer">
					<button type="button" class="btn btn-default" aria-label="Left Align">
						<span class="glyphicon glyphicon-heart" aria-hidden="true">
						<span class="badge">40</span>
						</span>
					</button>
					
				</div>
		
				</div>
			</div>
		</div>					  
		-->
	</div>

	<div class="col-md-5">
		
	</div>
	
</div>
	
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	
	<script>

	$(document).ready(function() {
		console.log("ready!");
		$.getJSON( "/nest/user/user-info", function( data ) {
			console.log(data);
			console.log(data.nick);
			$("h1").append(" "+data.nick);
		
			var room_list = $("#room_list");
			room_list.empty();
			room_list.append('<li class="active"><a href="">Dashboard</a></li>');
			
			$(data.rooms).each(function() {	
				room_list.append('<li><a href="#'+this.id+'">'+this.name+'</a></li>');
			});
				
			room_list.children().first().addClass("active");
		});
		
		$.getJSON("/nest/user/select-dashboard-messages?last=0", function(data) {
			console.log(data);
			
			var postt = '<div class="row feed_post">'+$("div.feed_post").html()+'</div>';
			$("#feed").empty();
			
			$(data).each(function(index, postObj) {
				
				var post = $(postt);
				
				if(postObj.creatorAvatarImg != null)
					$(".avatar", post).attr('src',"/nest"+postObj.creatorAvatarImg);
					
				$(".post_owner", post).text(this.creatorNick);
				$(".post_text", post).text(this.text);
				$(".post_likes", post).text(this.likes);
				$(".post_comments", post).text($(this.children).length);
				$(".post_like_button", post).click(function(e) {
					$.getJSON("/nest/user/add-like?messageId="+postObj.id, function(data2) {
						$(".post_likes", post).text(data2);
					});
					e.stopPropagation();
					//return false;
				});
				
				post.appendTo(feed);
				
				var comments = $(".post_comment", post);
					$(this.children).each(function(index, postObj){
						var comment = $(postt);
						
						if(postObj.creatorAvatarImg != null)
							$(".avatar", comment).attr('src',"/nest"+postObj.creatorAvatarImg);
							
						$(".post_owner", comment).text(this.creatorNick);
						$(".post_text", comment).text(this.text);
						$(".post_likes", comment).text(this.likes);
						$(".post_comment_button", comment).remove();
						$(".post_like_button", post).click(function(e) {
							$.getJSON("/nest/user/add-like?messageId="+postObj.id, function(data2) {
								$(".post_likes", post).text(data2);
							});
							e.stopPropagation();
							//return false;
						});
						
						comment.appendTo(comments);
					});
			});
		});
	});
	
	
	</script>
  </body>
</html>